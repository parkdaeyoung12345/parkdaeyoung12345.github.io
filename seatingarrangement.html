<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>학급 자리 배치</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }

        /* 책상 드래그 앤 드롭 스타일 */
        .grid-cell {
            transition: all 0.2s;
        }
        
        .grid-cell.drag-over {
            background-color: #e2e8f0;
            border: 2px dashed #94a3b8;
        }

        .desk {
            cursor: grab;
            transition: transform 0.2s, box-shadow 0.2s;
            user-select: none;
        }

        .desk:active {
            cursor: grabbing;
        }

        .desk.dragging {
            opacity: 0.5;
            transform: scale(1.05);
        }

        /* 배정 애니메이션 */
        @keyframes popIn {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .assigned-name {
            animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }
    </style>
</head>
<body class="bg-slate-50 min-h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-indigo-600 text-white p-4 shadow-md">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold"><i class="fas fa-chair mr-2"></i>학급 자리 배치 시스템</h1>
            <span class="text-sm opacity-80">드래그하여 책상 배치 변경 -> 배정하기</span>
        </div>
    </header>

    <main class="container mx-auto p-4 flex-grow flex flex-col lg:flex-row gap-6">
        
        <!-- Left Panel: Settings & Inputs -->
        <aside class="w-full lg:w-1/3 bg-white p-6 rounded-lg shadow-sm border border-slate-200 flex flex-col h-fit">
            <h2 class="text-lg font-semibold mb-4 text-slate-700 border-b pb-2">1. 학생 설정</h2>
            
            <div class="mb-4">
                <label class="block text-sm font-medium text-slate-600 mb-1">학생 수</label>
                <div class="flex gap-2">
                    <input type="number" id="studentCountInput" value="24" min="1" max="40" 
                           class="w-full border border-slate-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <button onclick="generateStudentInputs()" 
                            class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded transition whitespace-nowrap">
                        명단 생성
                    </button>
                </div>
            </div>

            <div class="flex justify-between items-center mb-2">
                <label class="block text-sm font-medium text-slate-600">학생 명단</label>
                <span id="currentCount" class="text-xs text-slate-400">0명</span>
            </div>
            
            <div id="studentListContainer" class="flex-grow overflow-y-auto max-h-[400px] space-y-2 pr-2">
                <p class="text-slate-400 text-center py-8 text-sm">학생 수를 입력하고 생성 버튼을 눌러주세요.</p>
            </div>
        </aside>

        <!-- Right Panel: Classroom Layout -->
        <section class="w-full lg:w-2/3 flex flex-col gap-4">
            
            <!-- Controls -->
            <div class="bg-white p-4 rounded-lg shadow-sm border border-slate-200 flex flex-wrap justify-between items-center gap-3">
                <h2 class="text-lg font-semibold text-slate-700">2. 교실 배치 및 배정</h2>
                <div class="flex gap-2">
                    <button onclick="resetLayout()" class="px-4 py-2 text-slate-600 hover:bg-slate-100 rounded border border-slate-300 transition text-sm">
                        <i class="fas fa-undo mr-1"></i> 책상 초기화 (6x4)
                    </button>
                    <button onclick="assignSeats()" class="px-6 py-2 bg-green-600 hover:bg-green-700 text-white rounded font-bold shadow-md transition hover:-translate-y-0.5 transform">
                        <i class="fas fa-check mr-1"></i> 자리 배정하기
                    </button>
                </div>
            </div>

            <!-- Drag & Drop Area -->
            <!-- We create a larger grid (e.g., 8x6) to allow moving desks around to create aisles -->
            <div class="bg-white p-6 rounded-lg shadow-lg border border-slate-200 overflow-x-auto">
                <div class="min-w-[600px] flex justify-center">
                    <div class="bg-slate-800 text-white px-12 py-2 rounded-b-lg mb-8 text-center text-sm font-medium w-1/2">
                        교탁 / 칠판
                    </div>
                </div>

                <!-- Grid Container -->
                <div id="classroomGrid" class="grid grid-cols-8 gap-2 min-w-[700px] mx-auto select-none" style="max-width: 900px;">
                    <!-- Cells generated by JS -->
                </div>
                
                <p class="text-center text-slate-400 text-xs mt-4">
                    <i class="fas fa-info-circle"></i> 책상을 드래그하여 원하는 위치로 이동시킬 수 있습니다.
                </p>
            </div>
        </section>
    </main>

    <footer class="bg-slate-100 py-4 text-center text-slate-500 text-sm">
        &copy; Classroom Seating Generator
    </footer>

    <script>
        // --- Data & State ---
        const SAMPLE_NAMES = [
            "김지우", "이서준", "박도현", "최하은", "정민준", "강서현", "조예준", "윤서윤", 
            "장건우", "임지민", "한지훈", "오수빈", "서준호", "신예은", "권동현", "황민지", 
            "안승우", "송하윤", "전우진", "홍서연", "유시우", "고은우", "문지후", "양예린",
            "손현우", "배서영", "조민재", "백하율", "허준영", "남수아", "심도윤", "노지아",
            "하준서", "곽채원", "성민재", "차소율", "주현준", "우다은", "구동현", "신지우"
        ];

        let draggedDesk = null;
        let originalParent = null;

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            initGrid();
            generateStudentInputs(); // Generate initial 24 students
        });

        // --- Functions ---

        // 1. Generate Student Inputs
        function generateStudentInputs() {
            const count = parseInt(document.getElementById('studentCountInput').value) || 0;
            const container = document.getElementById('studentListContainer');
            const countDisplay = document.getElementById('currentCount');

            if (count < 1) {
                alert("학생 수는 1명 이상이어야 합니다.");
                return;
            }

            container.innerHTML = '';
            countDisplay.innerText = `${count}명`;

            // Shuffle sample names to get random defaults
            const shuffledNames = [...SAMPLE_NAMES].sort(() => Math.random() - 0.5);

            for (let i = 0; i < count; i++) {
                const name = i < shuffledNames.length ? shuffledNames[i] : `학생${i+1}`;
                
                const div = document.createElement('div');
                div.className = "flex items-center gap-2 animate-[fadeIn_0.3s_ease-out]";
                div.innerHTML = `
                    <span class="text-slate-400 text-xs w-6 text-right">${i+1}.</span>
                    <input type="text" value="${name}" class="student-name-input flex-grow border border-slate-200 rounded px-2 py-1 text-sm focus:border-indigo-500 focus:outline-none bg-slate-50">
                `;
                container.appendChild(div);
            }
        }

        // 2. Initialize Grid (8 columns x 6 rows for flexibility)
        function initGrid() {
            const grid = document.getElementById('classroomGrid');
            grid.innerHTML = '';

            const totalRows = 6;
            const totalCols = 8;

            for (let i = 0; i < totalRows * totalCols; i++) {
                const cell = document.createElement('div');
                cell.className = "grid-cell w-full h-20 bg-slate-100 rounded border border-slate-200 flex items-center justify-center relative";
                cell.dataset.index = i;
                
                // Drag & Drop Event Listeners for Cells
                cell.addEventListener('dragover', handleDragOver);
                cell.addEventListener('dragleave', handleDragLeave);
                cell.addEventListener('drop', handleDrop);

                grid.appendChild(cell);
            }

            resetLayout();
        }

        // 3. Reset Layout (Place desks in center 6x4)
        function resetLayout() {
            const cells = document.querySelectorAll('.grid-cell');
            // Clear all cells
            cells.forEach(cell => cell.innerHTML = '');

            // Standard 6x4 layout centered in the 8x6 grid
            // Grid is 8 cols. We want cols 1-6 (indices 1 to 6) for rows 0-3.
            // Let's place 24 desks in a nice block.
            
            // Starting at row 1 (index 8) to leave space at front, and col 1 (index +1) to center
            let deskCount = 0;
            const rows = 4;
            const cols = 6;
            const startRow = 0; // Start at very top
            const startCol = 1; // Center horizontally (1 empty col left)

            for (let r = 0; r < rows; r++) {
                for (let c = 0; c < cols; c++) {
                    const gridIndex = (startRow + r) * 8 + (startCol + c);
                    if (gridIndex < cells.length) {
                        createDesk(cells[gridIndex], deskCount + 1);
                        deskCount++;
                    }
                }
            }
        }

        // 4. Create a Desk Element
        function createDesk(parentCell, id) {
            const desk = document.createElement('div');
            desk.className = "desk w-full h-full m-1 bg-amber-200 rounded-lg shadow-sm border-2 border-amber-300 flex flex-col items-center justify-center p-1";
            desk.draggable = true;
            desk.id = `desk-${id}`;
            desk.innerHTML = `
                <div class="text-[10px] text-amber-700 font-bold mb-1 opacity-50">책상</div>
                <div class="student-name font-bold text-slate-800 text-sm text-center break-keep leading-tight">-</div>
            `;

            // Drag Events for Desk
            desk.addEventListener('dragstart', handleDragStart);
            desk.addEventListener('dragend', handleDragEnd);

            parentCell.appendChild(desk);
        }

        // --- Drag & Drop Handlers ---

        function handleDragStart(e) {
            draggedDesk = this;
            originalParent = this.parentElement;
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = "move";
            // For Firefox
            e.dataTransfer.setData('text/plain', this.id);
        }

        function handleDragEnd(e) {
            this.classList.remove('dragging');
            draggedDesk = null;
            originalParent = null;
            
            // Clean up all highlights
            document.querySelectorAll('.grid-cell').forEach(cell => {
                cell.classList.remove('drag-over');
            });
        }

        function handleDragOver(e) {
            e.preventDefault(); // Necessary to allow dropping
            e.dataTransfer.dropEffect = "move";
            this.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            this.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            this.classList.remove('drag-over');

            // If we have a dragged desk
            if (draggedDesk) {
                // If this cell already has a desk, swap them
                if (this.children.length > 0) {
                    const existingDesk = this.children[0];
                    if (existingDesk !== draggedDesk) {
                        // Move existing desk to original parent of dragged desk
                        originalParent.appendChild(existingDesk);
                        // Move dragged desk here
                        this.appendChild(draggedDesk);
                    }
                } else {
                    // Empty cell, just move here
                    this.appendChild(draggedDesk);
                }
            }
        }

        // --- Assign Logic ---

        function assignSeats() {
            // 1. Get all student names
            const inputs = document.querySelectorAll('.student-name-input');
            let names = Array.from(inputs).map(input => input.value.trim()).filter(val => val !== "");

            if (names.length === 0) {
                alert("배정할 학생 이름이 없습니다.");
                return;
            }

            // 2. Get all desks currently on the grid
            const desks = document.querySelectorAll('.desk');
            
            if (desks.length === 0) {
                alert("배치된 책상이 없습니다.");
                return;
            }

            if (names.length > desks.length) {
                alert(`학생 수(${names.length}명)가 책상 수(${desks.length}개)보다 많습니다. 책상을 추가하거나 학생 수를 줄여주세요. (현재 UI에서는 책상 추가 기능 미지원, 초기화 필요)`);
                // Note: In this simple version, we don't dynamically add desks beyond reset, 
                // but user can reduce students.
                // We will proceed to assign as many as possible.
            }

            // 3. Shuffle names
            names = shuffleArray(names);

            // 4. Assign
            desks.forEach((desk, index) => {
                const nameContainer = desk.querySelector('.student-name');
                
                // Reset animation
                nameContainer.classList.remove('assigned-name');
                void desk.offsetWidth; // trigger reflow

                if (index < names.length) {
                    nameContainer.textContent = names[index];
                    nameContainer.classList.add('assigned-name');
                    desk.classList.add('bg-amber-100'); // slightly lighter when occupied
                    desk.classList.remove('bg-amber-200');
                } else {
                    nameContainer.textContent = "-";
                    desk.classList.remove('bg-amber-100');
                    desk.classList.add('bg-amber-200');
                }
            });
        }

        // Fisher-Yates Shuffle
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

    </script>
</body>
</html>
